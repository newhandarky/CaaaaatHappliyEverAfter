import{a as s,_ as i}from"./config-3a988531.js";import"./navbar-64ba0015.js";import"./aside-136a93d9.js";const p=document.querySelector(".checkInDate"),f=document.querySelector(".checkOutDate"),T=document.querySelector(".roomType"),$=document.querySelector(".catNum"),b=document.querySelector(".catName"),D=document.querySelector(".price"),S=document.querySelector(".remark"),y=document.querySelector(".toComfirmation");console.log(y);let r=JSON.parse(sessionStorage.getItem("catInfo")),o=JSON.parse(sessionStorage.getItem("bookingData"));console.log(r);console.log(o);p.innerHTML=o.checkIn;f.innerHTML=o.checkOut;T.innerHTML=o.roomType;$.innerHTML=r.catId.length;let I=r.catId;console.log(`貓咪ID:${I}`);let h="";I.forEach(function(n){s.get(`${i}/cats/${n}`).then(function(a){console.log(`貓的名字${a.data.catName}`),h+=` ${a.data.catName} `,console.log(h),b.textContent=h})});s.get(`${i}/rooms?name=${o.roomType}`).then(function(n){console.log(`房型資訊${n.data}`);let a=o.checkIn,g=o.checkOut,c=new Date(a),l=(new Date(g).getTime()-c.getTime())/(1e3*3600*24);console.log(`住${l}晚`),console.log(`貓${r.catId.length}隻`);let d=r.catId.length-1;console.log(`加${d}隻貓`);let k=`${n.data[0].price*l+300*d*l}元`;D.innerHTML=k,e.price=k,e.quantity=l,t.quantity=l,t.price=k});S.innerHTML=r.remark;let m=JSON.parse(localStorage.getItem("userTokenAndData"));console.log(`userId:${m.user.id}`);let e={};e.userId=m.user.id;e.bookingDate=o.bookingDate;e.checkIn=o.checkIn;e.checkOut=o.checkOut;e.roomType=o.roomType;e.cats=r.catId;e.remark=r.remark;e.state="已預訂";e.history=[];e.admin={};o.roomType==="經典房"&&(e.roomId=51);o.roomType==="精緻房"&&(e.roomId=52);o.roomType==="豪華房"&&(e.roomId=53);e.feedback="";console.log("打包到bookings");console.log(e);let t={};t.updateTime=o.bookingDate;t.state="已預訂";t.catNum=r.catId.length;t.remark=r.remark;t.checkIn=o.checkIn;t.checkOut=o.checkOut;t.userId=m.user.id;t.roomType=o.roomType;t.roomId=[];t.admin={};o.roomType==="經典房"&&(t.roomId=51);o.roomType==="精緻房"&&(t.roomId=52);o.roomType==="豪華房"&&(t.roomId=53);console.log("打包到bookingHistorys");console.log(t);y.addEventListener("click",function(n){n.preventDefault(),H()});function H(){O(),N()}function O(){s.post(`${i}/bookings`,e).then(n=>{console.log(n.data.id);let a=n.data.id;t.bookingId=a,console.log("NEW bookingHistory物件"),console.log(t),console.log(a),s.post(`${i}/bookingHistorys?bookingsId=${a}`,t).then(g=>{console.log("try"),console.log(g.data),s.get(`${i}/bookingHistorys?userId=${m.user.id}&bookingId=${a}`).then(c=>{console.log("訂單的booking History"),console.log(c.data);let u=c.data,l=[];u.forEach(function(d){console.log(d.id),l.push(d.id)}),console.log(l),e.history=l,console.log(e),s.patch(`${i}/bookings/${a}`,e).then(d=>{console.log(d.data)})})})}).catch(n=>{console.error(n)})}function N(){let n=[];s.get(`${i}/roomStates?date_gte=${o.checkIn}&date_lte=${o.checkOut}&date_ne=${o.checkOut}`).then(function(a){let g=a.data;console.log(g),g.forEach(function(c){o.roomType==="經典房"&&(c.availableCount.classic-=1,console.log(c),n.push(c)),o.roomType==="精緻房"&&(c.availableCount.delicate-=1,console.log(c),n.push(c)),o.roomType==="豪華房"&&(c.availableCount.luxury-=1,console.log(c),n.push(c))}),console.log(n),n.forEach(function(c){let u=c.id;console.log(u),s.patch(`${i}/roomStates/${u}`,c).then(function(l){console.log(l.data)})})})}
