import"./bootstrap.min-5750ef26.js";import"./admin_header-9ba12685.js";import"./admin_searchBar-edc2f847.js";import{a as g,_ as m}from"./config-4096d6dc.js";import{S as f}from"./sweetalert2.all-9b43cc60.js";import{h as c}from"./moment-fbc5633a.js";import{h as S}from"./admin_config-2cf1d757.js";const y=document.querySelector(".thisMonth"),M=document.querySelector(".newBooking"),Y=document.querySelector(".bookingRate"),C=document.querySelector(".revenue"),I=document.querySelector(".todayCheckIn"),D=document.querySelector(".todayCheckOut"),p=document.querySelector(".bookingList"),q=document.querySelector(".btnNewBooking"),v=document.querySelector(".btnTodayCheckIn"),B=document.querySelector(".btnTodayCheckOut"),E=document.querySelector(".checkBookingTable"),L=document.querySelector(".bookingTables"),k=document.querySelector(".date"),u=document.querySelector(".before"),T=document.querySelector(".after");localStorage.setItem("thisMonth",c().format("YYYY-MM"));let n={thisMonthCount:0,newBooking:0,todayCheckIn:0,todayCheckOut:0};k.textContent=c().format("YYYY-MM");const O=g.get(`${m}/660/roomStates`,S),x=g.get(`${m}/660/bookings?_expand=user&_expand=room`,S);function w(){M.innerHTML=n.newBooking,I.innerHTML=n.todayCheckIn,D.innerHTML=n.todayCheckOut}function d(o){if(o.searchDate===0)f.fire({title:"系統訊息",text:`並無${o.searchStr}`,icon:"warning"});else{const l=[];o.bookingData.forEach(function(a){a[o.itemStr]===c().format("YYYY-MM-DD")&&l.push(a)}),localStorage.setItem("searchResult",JSON.stringify(l)),localStorage.setItem("h2Content",`<span class="text-primary"> ${c().format("YYYY-MM-DD")} </span> ${o.searchStr}`),location="admin_bookingSearch.html"}}Promise.all([O,x]).then(function(o){const l=o[0].data,a=o[1].data;function h(t){const i=[],s=[];a.forEach(function(e){e.checkIn.startsWith(`${t}`)&&i.push(e)}),l.forEach(function(e){e.date.startsWith(`${t}`)&&s.push(e)}),b(i,s)}function b(t,i){let s=0;t.forEach(function(r){r.state==="已退房"&&(s+=parseInt(r.price))});let e=0;i.forEach(function(r){e+=r.availableCount.classic,e+=r.availableCount.delicate,e+=r.availableCount.luxury}),y.textContent=t.length,C.textContent=s,Y.textContent=Math.round((i.length*15-e)/(i.length*15)*100)}a.forEach(function(t){t.bookingDate===c().format("YYYY-MM-DD")&&n.newBooking++,t.checkIn===c().format("YYYY-MM-DD")&&n.todayCheckIn++,t.checkOut===c().format("YYYY-MM-DD")&&n.todayCheckOut++}),w(),q.addEventListener("click",function(){const t={searchDate:n.newBooking,bookingData:a,searchStr:"當日新進訂單",itemStr:"bookingDate"};d(t)}),v.addEventListener("click",function(){const t={searchDate:n.todayCheckIn,bookingData:a,searchStr:"當日入住訂單",itemStr:"checkIn"};d(t)}),B.addEventListener("click",function(){const t={searchDate:n.todayCheckOut,bookingData:a,searchStr:"當日退房訂單",itemStr:"checkOut"};d(t)}),h(localStorage.getItem("thisMonth")),u.addEventListener("click",function(){let t=c(localStorage.getItem("thisMonth")).add(-1,"month").format("YYYY-MM");if(t==="2023-08"){f.fire({title:"抱歉並無2023-09以前的資料",icon:"error"}),u.setAttribute("disabled",!0);return}localStorage.setItem("thisMonth",t),h(localStorage.getItem("thisMonth")),k.textContent=localStorage.getItem("thisMonth")}),T.addEventListener("click",function(){let t=c(localStorage.getItem("thisMonth")).add(1,"month").format("YYYY-MM");localStorage.setItem("thisMonth",t),u.removeAttribute("disabled"),h(localStorage.getItem("thisMonth")),k.textContent=localStorage.getItem("thisMonth")})}).catch(function(o){console.log(o)});p.addEventListener("click",function(){n.bookingCount===0&&console.log("當月無訂房"),location="admin_bookingList.html"});E.addEventListener("click",function(){location="admin_bookingRoomTable.html"});L.addEventListener("click",function(){location="admin_bookingTables.html"});
