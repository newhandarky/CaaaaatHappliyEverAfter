import{a as s,_ as i}from"./config-82256151.js";import"./navbar-5c89ec87.js";import"./aside-096a2e7a.js";const p=document.querySelector(".checkInDate"),f=document.querySelector(".checkOutDate"),$=document.querySelector(".roomType"),b=document.querySelector(".catNum"),T=document.querySelector(".catName"),D=document.querySelector(".price"),S=document.querySelector(".remark"),y=document.querySelector(".toComfirmation");console.log(y);let r=JSON.parse(sessionStorage.getItem("catInfo")),o=JSON.parse(sessionStorage.getItem("bookingData"));console.log(r);console.log(o);p.innerHTML=o.checkIn;f.innerHTML=o.checkOut;$.innerHTML=o.roomType;b.innerHTML=r.catId.length;let I=r.catId;console.log(`貓咪ID:${I}`);let h="";I.forEach(function(t){s.get(`${i}/cats/${t}`).then(function(a){console.log(`貓的名字${a.data.catName}`),h+=` ${a.data.catName} `,console.log(h),T.textContent=h})});s.get(`${i}/rooms?name=${o.roomType}`).then(function(t){console.log(`房型資訊${t.data}`);let a=o.checkIn,m=o.checkOut,c=new Date(a),l=(new Date(m).getTime()-c.getTime())/(1e3*3600*24);console.log(`住${l}晚`),console.log(`貓${r.catId.length}隻`);let g=r.catId.length-1;console.log(`加${g}隻貓`);let k=t.data[0].price*l+300*g;D.innerHTML=k,e.price=k,e.quantity=l,n.quantity=l,n.price=k});S.innerHTML=r.remark;let u=JSON.parse(localStorage.getItem("userTokenAndData"));console.log(`userId:${u.user.id}`);let e={};e.userId=u.user.id;e.bookingDate=o.bookingDate;e.checkIn=o.checkIn;e.checkOut=o.checkOut;e.roomType=o.roomType;e.cats=r.catId;e.remark=r.remark;e.state="已預訂";e.history=[];e.admin={};o.roomType==="經典房"&&(e.roomId=51);o.roomType==="精緻房"&&(e.roomId=52);o.roomType==="豪華房"&&(e.roomId=53);e.feedback="";console.log("打包到bookings");console.log(e);let n={};n.updateTime=o.bookingDate;n.state="已預訂";n.catNum=r.catId.length;n.remark=r.remark;n.checkIn=o.checkIn;n.checkOut=o.checkOut;n.userId=u.user.id;n.roomType=o.roomType;n.roomId=[];n.admin={};o.roomType==="經典房"&&(n.roomId=51);o.roomType==="精緻房"&&(n.roomId=52);o.roomType==="豪華房"&&(n.roomId=53);console.log("打包到bookingHistorys");console.log(n);y.addEventListener("click",function(t){t.preventDefault(),H()});function H(){O(),N()}function O(){s.post(`${i}/bookings`,e).then(t=>{console.log(t.data),q()}).catch(t=>{console.error(t)})}function N(){let t=[];s.get(`${i}/roomStates?date_gte=${o.checkIn}&date_lte=${o.checkOut}&date_ne=${o.checkOut}`).then(function(a){a.data.forEach(function(c){o.roomType==="經典房"&&(c.availableCount.classic-=1,console.log(c),t.push(c)),o.roomType==="精緻房"&&(c.availableCount.delicate-=1,console.log(c),t.push(c)),o.roomType==="豪華房"&&(c.availableCount.luxury-=1,console.log(c),t.push(c))}),console.log(t),t.forEach(function(c){let d=c.id;console.log(d),s.patch(`${i}/roomStates/${d}`,c).then(function(l){console.log(l.data)})})})}function q(){s.get(`${i}/bookings?userId=${u.user.id}&bookingDate=${o.bookingDate}`).then(t=>{console.log(t.data),console.log(`bookingID:${t.data[0].id}`);let a=t.data[0].id;n.bookingId=a,console.log("NEW bookingHistory物件"),console.log(n),console.log(a),s.post(`${i}/bookingHistorys?bookingsId=${a}`,n).then(m=>{console.log("try"),console.log(m.data),s.get(`${i}/bookingHistorys?userId=${u.user.id}&?bookingId=${a}`).then(c=>{console.log("訂單的booking History"),console.log(c.data);let d=c.data,l=[];d.forEach(function(g){console.log(g.id),l.push(g.id)}),console.log(l),e.history=l,console.log(e),s.patch(`${i}/bookings/${a}`,e).then(g=>{console.log(g.data)})})})})}
