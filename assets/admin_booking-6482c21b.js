import{S as m}from"./sweetalert2.all-1988d671.js";import"./admin_header-58c6939d.js";import"./admin_searchBar-c8861ea1.js";import{a as g,_ as f}from"./config-4096d6dc.js";import{h as a}from"./moment-fbc5633a.js";import{h as S}from"./admin_config-2cf1d757.js";import{r as y}from"./loginIsTimeUp-72a7432e.js";const M=document.querySelector(".thisMonth"),Y=document.querySelector(".newBooking"),C=document.querySelector(".bookingRate"),I=document.querySelector(".revenue"),D=document.querySelector(".todayCheckIn"),p=document.querySelector(".todayCheckOut"),q=document.querySelector(".bookingList"),v=document.querySelector(".btnNewBooking"),L=document.querySelector(".btnTodayCheckIn"),B=document.querySelector(".btnTodayCheckOut"),E=document.querySelector(".checkBookingTable"),T=document.querySelector(".bookingTables"),k=document.querySelector(".date"),u=document.querySelector(".before"),O=document.querySelector(".after");localStorage.setItem("thisMonth",a().format("YYYY-MM"));let n={thisMonthCount:0,newBooking:0,todayCheckIn:0,todayCheckOut:0};k.textContent=a().format("YYYY-MM");const x=g.get(`${f}/660/roomStates`,S),w=g.get(`${f}/660/bookings?_expand=user&_expand=room`,S);function _(){Y.innerHTML=n.newBooking,D.innerHTML=n.todayCheckIn,p.innerHTML=n.todayCheckOut}function d(o){if(o.searchDate===0)m.fire({title:"系統訊息",text:`並無${o.searchStr}`,icon:"warning"});else{const h=[];o.bookingData.forEach(function(c){c[o.itemStr]===a().format("YYYY-MM-DD")&&h.push(c)}),localStorage.setItem("searchResult",JSON.stringify(h)),localStorage.setItem("h2Content",`<span class="text-primary"> ${a().format("YYYY-MM-DD")} </span> ${o.searchStr}`),location="admin_bookingSearch.html"}}Promise.all([x,w]).then(function(o){const h=o[0].data,c=o[1].data;function l(t){const r=[],s=[];c.forEach(function(e){e.checkIn.startsWith(`${t}`)&&r.push(e)}),h.forEach(function(e){e.date.startsWith(`${t}`)&&s.push(e)}),b(r,s)}function b(t,r){let s=0;t.forEach(function(i){i.state==="已退房"&&(s+=parseInt(i.price))});let e=0;r.forEach(function(i){e+=i.availableCount.classic,e+=i.availableCount.delicate,e+=i.availableCount.luxury}),M.textContent=t.length,I.textContent=s,C.textContent=Math.round((r.length*15-e)/(r.length*15)*100)}c.forEach(function(t){t.bookingDate===a().format("YYYY-MM-DD")&&n.newBooking++,t.checkIn===a().format("YYYY-MM-DD")&&n.todayCheckIn++,t.checkOut===a().format("YYYY-MM-DD")&&n.todayCheckOut++}),_(),v.addEventListener("click",function(){const t={searchDate:n.newBooking,bookingData:c,searchStr:"當日新進訂單",itemStr:"bookingDate"};d(t)}),L.addEventListener("click",function(){const t={searchDate:n.todayCheckIn,bookingData:c,searchStr:"當日入住訂單",itemStr:"checkIn"};d(t)}),B.addEventListener("click",function(){const t={searchDate:n.todayCheckOut,bookingData:c,searchStr:"當日退房訂單",itemStr:"checkOut"};d(t)}),l(localStorage.getItem("thisMonth")),u.addEventListener("click",function(){let t=a(localStorage.getItem("thisMonth")).add(-1,"month").format("YYYY-MM");if(t==="2023-08"){m.fire({title:"抱歉並無2023-09以前的資料",icon:"error"}),u.setAttribute("disabled",!0);return}localStorage.setItem("thisMonth",t),l(localStorage.getItem("thisMonth")),k.textContent=localStorage.getItem("thisMonth")}),O.addEventListener("click",function(){let t=a(localStorage.getItem("thisMonth")).add(1,"month").format("YYYY-MM");localStorage.setItem("thisMonth",t),u.removeAttribute("disabled"),l(localStorage.getItem("thisMonth")),k.textContent=localStorage.getItem("thisMonth")})}).catch(function(o){y(o.response.data)});q.addEventListener("click",function(){n.bookingCount===0&&m.fire("無當月訂單, 請重新查詢"),location="admin_bookingList.html"});E.addEventListener("click",function(){location="admin_bookingRoomTable.html"});T.addEventListener("click",function(){location="admin_bookingTables.html"});
